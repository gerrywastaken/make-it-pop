name: Upload to Mozilla Add-ons

on:
  workflow_dispatch:  # Manual trigger only
    inputs:
      release_tag:
        description: 'Release URL or tag (e.g., https://github.com/gerrywastaken/make-it-pop/releases/tag/v1.0.3-20251120-224046 OR v1.0.3-20251120-224046)'
        required: true
        type: string

jobs:
  extract-tag:
    runs-on: ubuntu-latest
    outputs:
      release_tag: ${{ steps.extract.outputs.tag }}
    steps:
      - name: Extract release tag from URL or input
        id: extract
        run: |
          INPUT="${{ inputs.release_tag }}"
          # If input contains '/releases/tag/', extract the tag portion
          if [[ "$INPUT" == *"/releases/tag/"* ]]; then
            RELEASE_TAG="${INPUT##*/}"
            echo "Extracted tag from URL: $RELEASE_TAG"
          else
            RELEASE_TAG="$INPUT"
            echo "Using tag as provided: $RELEASE_TAG"
          fi
          echo "tag=${RELEASE_TAG}" >> $GITHUB_OUTPUT

  upload:
    needs: extract-tag
    uses: ./.github/workflows/mozilla-upload-steps.yml
    secrets: inherit
    with:
      release_tag: ${{ needs.extract-tag.outputs.release_tag }}
      dry_run: false
